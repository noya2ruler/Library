# Dinic 法の解説

## はじめに

Dinic 法は最大流を求めるアルゴリズムのひとつです。
最大流問題については `maxflow-editorial.md` を参照してください。用語および記号は同じものを使用します。

Dinic 法は、ネットワーク $(G,u,s,t)$ を入力として以下を満たす $f$ をひとつ求めるアルゴリズムです。
- $s-t$ フロー $f$ であって流量 $|f|$ が最大となる

時間計算量は $\mathrm{O}(|V|^2|E|)$ です。特殊なグラフではより強い保証を与えられますが、これについては後述します。

## 参考資料

次の資料を大きく参考にした。その行間を埋めるとともに、アルゴリズムのお気持ちを言語化することを意識した。

https://misawa.github.io/others/flow/dinic_time_complexity.html

## Dinic 法の概要

### アルゴリズム

1. 暫定解のフロー $f$ を $f=\boldsymbol{0}$ で初期化する ( $\forall e\in E, f(e)=0$ )。
2. 次の dual-primal step を $G_f$ の増加路が存在しなくなるまで繰り返す。
   
   dual-primal step

   dual step :
   - $G_f$ 上の $s-t$ 最短経路DAG $H_0$ を求める。
  
   primal step :
   - グラフ $H$ を $H_0$ で初期化する。
   - $H$ が空グラフになるまで次を繰り返す。
   - 1. $H$ 上の $s-t$ パスをひとつ求める。
   - 2. そのパス上にフローを流せるだけ流す。
   - 3. 容量が $0$ になった辺を $H$ から取り除く。
   - 4. $s$ から辿り着けない頂点、 $t$ へ辿り着けない頂点を $H$ から取り除く。
   - 5. 取り除いた頂点に隣接する辺を $H$ から取り除く。
   - 流れたフローを $f$ に反映する。
   - 特に $G_f$ の容量が更新される。
       
### 各用語の説明

#### フローをベクトルとも見ることについて
フロー $f:E\to \mathbb{R}$ は写像ですが、扱うグラフは有限グラフなので $E$ の要素を適当に順序づけることができ、 $e_1,e_2,\dots ,e_{|E|}$ とすれば $\boldsymbol{f}=(f_1,f_2,\dots ,f_{|E|})$ であって $f_i=f(e_i)$ です。本文ではボールド表記をせず、 $f$ とかいたときに辺番号または辺を引数にとってその辺の流量を返すものします。

#### パス
パスは頂点列です。

$L$ を非負整数とします。長さ $L+1$ の列 $(v_0,v_1,\dots ,v_L)$ が
$G=(V,E)$ 上の $s-t$ パスであるとは、以下を満たすとき、またそのときに限ります。
- $v_0=s,\ v_{L+1}=t$
- $\forall i\in \lbrace 0,1,\dots, L-1 \rbrace , (v_i,v_{i+1})\in E$

特にそのパスの長さ (経路長) は $L$ です。

#### 最短経路DAG
$s-t$ 最短経路DAG $H_0$ は $s-t$ 最短距離を $L$ として、$s-t$ パスであって経路長が $L$ であるものを全て集めてできるグラフです。

#### フローを流せるだけ流す
$s-t$ パスを構成する辺の容量の最小値を $\delta$ として、$s$ から $t$ へ流量　$\delta$ のフローを流します。つまり、暫定解のフロー $f$ に対して次を行います。
- $s-t$ パスを $(s=v_0,v_1,\dots ,v_L=t)$ とする。
- $\displaystyle\delta = \min_{i=0,1,\dots, L} u_f(v_i,v_{i+1})$ とする。
- $i= 0,1,\dots, L-1$ に対して $f(v_i,v_{i+1})\gets f(v_i,v_{i+1})+\delta$ という更新を行う。



